gsap.registerPlugin(ScrollTrigger);

const screenWidth = window.innerWidth;
const breakpoint = 641;

document.addEventListener("DOMContentLoaded", function () {
  //Обработка нажатия бургер меню
  document
    .querySelector(".header__burger")
    .addEventListener("click", function () {
      this.classList.toggle("open");
      document.querySelector(".header__nav-list").classList.toggle("open");
      document.body.classList.toggle("no-scroll");
    });

  //Обработка клика по свободному месту в мобильном меню
  document.addEventListener("click", function (event) {
    var isClickInsideMenu = document
      .querySelector(".header__link")
      .contains(event.target);
    var isBurgerClicked = document
      .querySelector(".header__burger")
      .contains(event.target);

    if (!isClickInsideMenu && !isBurgerClicked) {
      // Закрыть меню
      document.querySelector(".header__nav-list").classList.remove("open");
      document.body.classList.remove("no-scroll");
    }
  });

  const blogRecommendations = new Swiper(".blog-recommendations__swiper", {
    // Опции слайдера
    loop: true, // Бесконечная прокрутка
    // autoplay: {
    //   delay: 3000, // Время автопрокрутки в миллисекундах
    // },
    // centeredSlides: true,
    slidesPerView: 1,
    // spaceBetween: 20,
    navigation: {
      nextEl: ".blog-recommendations__swiper-button-next",
      prevEl: ".blog-recommendations__swiper-button-prev",
    },
    breakpoints: {
      320: {
        slidesPerView: 1,
        spaceBetween: 60,
      },
      640: {
        slidesPerView: 2,
        spaceBetween: 30,
      },
      760: {
        slidesPerView: 3,
        spaceBetween: 30,
      },
    },
  });


  // Получаем все элементы с классом .practice-list
  let practiceLists = document.querySelectorAll(".practice-list");

  // Проверяем, есть ли эти элементы на странице
  if (practiceLists.length > 0) {
    //Функция анимации списков
    function animateList(list) {
      gsap.fromTo(
        list.querySelectorAll(".practice-list__item"), // Анимируем каждый элемент списка,
        {
          opacity: 0,
          // yPercent: 100,
        },
        {
          opacity: 1,
          // yPercent: 0,
          stagger: 0.1,
        }
      );
    }

    practiceLists.forEach((list) => {
      if (list.getBoundingClientRect().top < window.innerHeight) {
        // Если заголовок уже видим при загрузке
        animateList(list);
      } else {
        // Если заголовок появляется при скролле
        ScrollTrigger.create({
          trigger: list,
          start: "top 70%",
          onEnter: () => animateList(list),
          once: true, // Триггер сработает только один раз
        });
      }
    });
  }

  //Анимация параграфов
  function animateText(container) {
    const paragraphs =
      container.tagName === "P" ? [container] : container.querySelectorAll("p");
    gsap.fromTo(
      paragraphs,
      { opacity: 0 },
      { opacity: 1, stagger: 0.5, duration: 1 }
    );
  }

  let textToAnimate = document.querySelectorAll(".animate-text");

  if (textToAnimate.length > 0) {
    textToAnimate.forEach((element) => {
      if (element.getBoundingClientRect().top < window.innerHeight) {
        // Если элемент уже видим при загрузке
        animateText(element);
      } else {
        // Если элемент появляется при скролле
        ScrollTrigger.create({
          trigger: element,
          start: "top 60%",
          onEnter: () => animateText(element),
          once: true, // Триггер сработает только один раз
        });
      }
    });
  }

  //Общий случай анимации любого блока
  function animateOpacity(container) {
    gsap.fromTo(
      container,
      { opacity: 0 },
      { opacity: 1, duration: 1, delay: 0.1 }
    );
  }

  let animateOpacityItems = document.querySelectorAll(".animate-opacity");

  if (animateOpacityItems.length > 0) {
    animateOpacityItems.forEach((element) => {
      if (element.getBoundingClientRect().top < window.innerHeight) {
        // Если элемент уже видим при загрузке
        animateOpacity(element);
      } else {
        // Если элемент появляется при скролле
        ScrollTrigger.create({
          trigger: element,
          start: "top 60%",
          onEnter: () => animateOpacity(element),
          once: true, // Триггер сработает только один раз
        });
      }
    });
  }
});
